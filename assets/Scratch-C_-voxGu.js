import{C as E,m as be}from"./hyl-BIBvUTh2.js";import{d as ze,r as d,e as ke,f as Ve,o as h,c as T,a,g as Ie,h as ee,n as re,i as ne,_ as ie,S as V,j as Te,w as N,u as p,k as l,l as u,t as Q,F as Ce,m as Ee,p as Z,q as Ue,s as Ae,v as I,b as L,x as Be,y as ue,z as Ne,A as Le,B as H}from"./index-D2LZVifD.js";const Pe=["width","height"],Re=ze({__name:"StratchCard",props:{scratchPercent:{type:Number,default:80},imageUrl:{type:String},maskColor:{type:String,default:"#cccccc"},fillStyle:{type:String,default:"#000000"},font:{type:String,default:"18px Arial"},text:{type:String,default:"刮一刮"},radius:{type:Number,default:0},scratchRadius:{type:Number,default:10},callBackValue:{default:""},size:{type:Number,default:250}},emits:["scratchStart","scratchEnd","scratchAll"],setup(Y,{expose:f,emit:F}){const m=Y,w=F,o=d(null),O=d(null),r=d(null),i=d(0),v=d(0),S=d(!1),C=()=>{z(),ne(()=>{P(),$()})},z=()=>{var n,s;i.value=((n=O.value)==null?void 0:n.offsetWidth)||0,v.value=((s=O.value)==null?void 0:s.offsetHeight)||0},P=()=>{var n;if(o.value=(n=r.value)==null?void 0:n.getContext("2d"),o.value){if(o.value.globalAlpha=1,o.value.fillStyle=m.maskColor,m.radius){const s=m.radius;o.value.beginPath(),o.value.moveTo(s,0),o.value.arcTo(0,0,0,s,s),o.value.lineTo(0,v.value-s),o.value.arcTo(0,v.value,s,v.value,s),o.value.lineTo(i.value-s,v.value),o.value.arcTo(i.value,v.value,i.value,v.value-s,s),o.value.lineTo(i.value,s),o.value.arcTo(i.value,0,i.value-s,0,s),o.value.closePath(),o.value.clip()}if(o.value.fillRect(0,0,i.value,v.value),!m.imageUrl){o.value.fillStyle=m.fillStyle,o.value.font=m.font;let s=m.text,g=o.value.measureText(s).width,_=i.value/2-g/2,B=v.value/2+6;o.value.fillText(s,_,B)}if(m.imageUrl){const s=new Image;s.src=m.imageUrl,s.onload=()=>{var g;(g=o.value)==null||g.drawImage(s,0,0,i.value,v.value)}}}},$=()=>{r.value&&(r.value.addEventListener("mousedown",n=>{S.value=!0,y(n)}),r.value.addEventListener("mousemove",n=>{S.value==!0&&y(n)}),r.value.addEventListener("mouseup",()=>{S.value=!1,x()}),r.value.addEventListener("touchstart",n=>{w("scratchStart"),S.value=!0,y(n)}),r.value.addEventListener("touchmove",n=>{S.value==!0&&y(n)}),r.value.addEventListener("touchend",()=>{S.value=!1,w("scratchEnd"),x()}))},y=n=>{if(!r.value||!o.value)return;const s=r.value.getBoundingClientRect(),g=document.documentElement.scrollTop||document.body.scrollTop,_=document.documentElement.scrollLeft||document.body.scrollLeft;let B=0,R=0;if(n instanceof MouseEvent)B=n.pageX-s.left-_,R=n.pageY-s.top-g;else if(n instanceof TouchEvent)B=n.targetTouches[0].pageX-s.left-_,R=n.targetTouches[0].pageY-s.top-g;else return;o.value.globalCompositeOperation="destination-out",o.value.beginPath(),o.value.fillStyle="white",o.value.moveTo(B,R),o.value.arc(B,R,m.scratchRadius,0,3*Math.PI),o.value.fill()},U=()=>{i.value=0,v.value=0,ne(()=>{C()})},x=()=>{if(!r.value||!o.value)return;let n=o.value.getImageData(0,0,i.value,v.value),s=0,g=n.data.length/4;for(let _=0;_<n.data.length;_+=4)n.data[_+3]==0&&s++;s>=g*(m.scratchPercent/100)&&(r.value.remove(),w("scratchAll",m.callBackValue))},A=()=>{o.value=null,C()};return ke(()=>{C(),window.addEventListener("resize",A)}),Ve(()=>{window.removeEventListener("resize",A)}),f({reset:U}),(n,s)=>(h(),T("div",{class:"box shadow",style:re({borderRadius:Y.radius+"px",height:`${Y.size}px`})},[a("div",{ref_key:"slot",ref:O,class:"slot"},[Ie(n.$slots,"default",{},void 0,!0)],512),i.value&&v.value?(h(),T("canvas",{key:0,class:"canvas",ref_key:"canvas",ref:r,width:i.value,height:v.value},null,8,Pe)):ee("",!0)],4))}}),$e=ie(Re,[["__scopeId","data-v-5e5c6078"]]),qe={class:"app-content"},Me={key:0,class:"float-top-card"},De={class:"d-flex mb-2 align-items-center",style:{width:"20rem"}},He={class:"d-flex mt-2 align-items-center",style:{width:"20rem"}},Oe={class:"d-flex mt-2 align-items-center",style:{width:"20rem"}},We={class:"text-danger"},Je={class:"row align-items-center"},Xe=["src"],Ye={key:0,class:"float-card"},Fe={class:"d-flex flex-column"},je={class:"d-flex align-items-center"},Ge={class:"d-flex align-items-center mt-2"},Ke={class:"d-flex align-items-center mt-2"},Qe={class:"d-flex align-items-center mt-2"},Ze={class:"mt-2"},et={key:0},tt={class:"d-flex align-items-center"},lt={key:1},at={class:"d-flex flex-column"},st={class:"d-flex"},ot={class:"mt-2"},nt={class:"d-flex align-items-center mt-2"},ut={class:"mt-2"},rt={key:1,class:"float-card"},it={key:1,class:"security_code"},ct={class:"text-danger"},dt={__name:"Scratch",setup(Y){let f=!1,F=!1;const m=Ae();let w=null,o=d("未使用预设模式");try{if(m.query&&m.query.c){const t=m.query.c,b=E.enc.Base64.parse(t).toString(E.enc.Utf8);w=JSON.parse(b),o.value=E.MD5(b).toString().substring(0,6).toUpperCase(),f=!0}m.query&&m.query.mode==="2"&&(F=!0,V.fire({title:"预设模式",text:"预设模式下，可通过右上角生成预设配置",icon:"info"}))}catch(t){V.fire({title:"预设配置解析失败",icon:"error"}),console.error(t)}function O(t){return t.sort(()=>Math.random()-.5)}let r=d([]),i=f?w.prizes_number:localStorage.getItem("scratch_prizes_number");i==null||i===NaN?i=5:i=parseInt(i)<=0?5:parseInt(i);const v=d(i);let S=f?w.theType:localStorage.getItem("scratch_theType");S!=="serial"&&S!=="prize"&&(S="serial");let C=f?w.prizes_input:localStorage.getItem("scratch_prizes_input");(typeof C!="string"||C==="")&&(C=`A
B
C`);let z=f?w.winning_position:localStorage.getItem("scratch_winning_position");z==null||z===NaN?z=3:z=parseInt(z)<=0?3:parseInt(z);let P=f?w.losing_lottery:localStorage.getItem("scratch_losing_lottery");(typeof P!="string"||P==="")&&(P="感谢参与");let $=f?w.use_music:localStorage.getItem("scratch_use_music")==="true";typeof $!="boolean"&&($=!1);let y=f?w.block_size:localStorage.getItem("scratch_block_size");y==null||y===NaN?y=150:y=parseInt(y)<100?100:parseInt(y),f||(localStorage.setItem("scratch_prizes_number",i),localStorage.setItem("scratch_theType",S),localStorage.setItem("scratch_prizes_input",C),localStorage.setItem("scratch_winning_position",z),localStorage.setItem("scratch_losing_lottery",P),localStorage.setItem("scratch_use_music",$),localStorage.setItem("scratch_block_size",y));const U=d(z),x=d(S),A=d([]),n=d(C),s=d(P),g=d($),_=d(y),B=Te(()=>x.value==="serial"?U.value:x.value==="prize"?A.value.length:1);N(n,t=>{try{A.value=t.split(`
`)}catch{A.value=[]}localStorage.setItem("scratch_prizes_input",t)},{immediate:!0}),N(x,t=>{localStorage.setItem("scratch_theType",t)}),N(U,t=>{localStorage.setItem("scratch_winning_position",t)}),N(s,t=>{localStorage.setItem("scratch_losing_lottery",t)}),N(g,t=>{localStorage.setItem("scratch_use_music",t),t||W.value.pause()}),N(_,t=>{localStorage.setItem("scratch_block_size",t)}),N(v,t=>{localStorage.setItem("scratch_prizes_number",t)});const R=()=>{if(x.value==="serial"){r.value=[];for(let t=1;t<=v.value;t++)r.value.push({name:t.toString(),show:!1,lottery:t<=U.value})}else if(x.value==="prize"){r.value=[],A.value.forEach((t,e)=>{r.value.push({name:t,show:!1,lottery:!0})});for(let t=1;t<=v.value-A.value.length;t++)r.value.push({name:s.value,show:!1,lottery:!1})}r.value=O(r.value)};R();const ce=()=>{window.location.reload()},W=d(),de=()=>{W.value.pause()},ve=()=>{},me=t=>{r.value[t].show=!0,V.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:10*1e3,timerProgressBar:!0,didOpen:b=>{b.onmouseenter=V.stopTimer,b.onmouseleave=V.resumeTimer}}).fire({icon:r.value[t].lottery?"success":"info",title:r.value[t].lottery?"恭喜您中大奖了！<br>快去领取奖品吧 ^_^ 》":"再接再利！<br>快去领取奖品吧 艹~艹 》"}),r.value[t].lottery?g.value&&W.value.play():W.value.pause()},q=d(!1),M=d(f),J=d(f?w.finalize_unlock_password:""),K=d("");N(K,t=>{J.value=E.SHA256(t).toString()});const pe=async()=>{const{value:t}=await V.fire({title:"输入解稿密码",input:"password",inputLabel:"Password",inputPlaceholder:"Enter your password",inputAttributes:{maxlength:"20",autocapitalize:"off",autocorrect:"off"}});t&&(J.value=E.SHA256(t).toString(),V.fire({title:"设置解稿密码成功！",icon:"success"}),M.value=!0)},fe=async()=>{const{value:t}=await V.fire({title:"输入解稿密码",input:"password",inputLabel:"Password",inputPlaceholder:"Enter your password",inputAttributes:{maxlength:"20",autocapitalize:"off",autocorrect:"off"}});t&&(E.SHA256(t).toString()===J.value?(M.value=!1,q.value=!0,f&&(o.value="已解稿")):V.fire({title:"解稿失败，密码错误！",icon:"warning"}))},_e=()=>{M.value?(q.value=!1,fe()):q.value=!q.value},te=d("url"),X=d(""),le=d("待生成"),ge=()=>{if(!J.value){V.fire({title:"请先设置解稿密码",icon:"warning"});return}const t=JSON.stringify({prizes_number:v.value,theType:x.value,prizes_input:n.value,winning_position:U.value,losing_lottery:s.value,use_music:g.value,block_size:_.value,finalize_unlock_password:J.value});le.value=E.MD5(t).toString().substring(0,6).toUpperCase();const e=E.enc.Utf8.parse(t),b=encodeURIComponent(E.enc.Base64.stringify(e));X.value="https://tools.fmaxc.cn/scratch?c="+b},ye=()=>{X.value&&(navigator.clipboard.writeText(X.value),V.fire({title:"网页链接复制成功！",icon:"success"}))};return(t,e)=>{const b=I("el-input"),j=I("el-radio-button"),ae=I("el-radio-group"),k=I("el-icon"),G=I("el-button"),se=I("el-input-number"),he=I("el-switch"),D=I("el-tooltip"),we=I("el-slider"),Se=I("el-popconfirm"),xe=I("el-result");return h(),T("div",qe,[p(F)?(h(),T("div",Me,[e[18]||(e[18]=a("h4",null,"预设生成",-1)),e[19]||(e[19]=a("hr",{class:"my-3"},null,-1)),a("div",De,[e[12]||(e[12]=a("h6",{class:"text-nowrap"},"解稿密码：",-1)),l(b,{type:"password",modelValue:K.value,"onUpdate:modelValue":e[0]||(e[0]=c=>K.value=c)},null,8,["modelValue"])]),e[20]||(e[20]=a("hr",{class:"my-3"},null,-1)),l(ae,{modelValue:te.value,"onUpdate:modelValue":e[1]||(e[1]=c=>te.value=c)},{default:u(()=>[l(j,{value:"url"},{default:u(()=>e[13]||(e[13]=[L("链接")])),_:1}),l(j,{value:"code"},{default:u(()=>e[14]||(e[14]=[L("配置码")])),_:1})]),_:1},8,["modelValue"]),a("div",He,[e[15]||(e[15]=a("h6",null,"URL：",-1)),l(b,{modelValue:X.value,"onUpdate:modelValue":e[2]||(e[2]=c=>X.value=c)},null,8,["modelValue"]),a("a",{href:"#",class:"ms-1 flex-center",onClick:ye},[l(k,{size:"20"},{default:u(()=>[l(p(Be))]),_:1})])]),a("div",Oe,[e[16]||(e[16]=a("h6",null,"防伪码：",-1)),a("span",We,Q(le.value),1)]),l(G,{class:"mt-2 w-100",onClick:ge},{default:u(()=>e[17]||(e[17]=[L("生成")])),_:1})])):ee("",!0),e[37]||(e[37]=a("h1",{class:"my-3 fw-bold text-center"},"幸运刮刮乐 🎉",-1)),e[38]||(e[38]=a("hr",{class:"my-3"},null,-1)),a("div",Je,[(h(!0),T(Ce,null,Ee(p(r),(c,oe)=>(h(),T("div",{key:oe,class:"col-auto m-2 prize-box"},[l($e,{maskColor:"#82868b",fillStyle:"black",font:"50px 微软雅黑",text:"",radius:5,scratchRadius:30,scratchPercent:1,callBackValue:oe,size:_.value,onScratchStart:de,onScratchEnd:ve,onScratchAll:me},{default:u(()=>[a("div",{class:"prize fw-bold",style:re({color:c.lottery?"#e45656":"#6c757d",height:`${_.value}px`,width:`${_.value}px`})},Q(c.name),5)]),_:2},1032,["callBackValue","size"])]))),128))]),a("audio",{src:p(be),ref_key:"audio",ref:W},null,8,Xe),a("div",{class:Ue(["float-card-content",`${q.value&&!M.value?"open":""} ${p(f)?"presuppose":""}`])},[a("div",{class:"close cursor-pointer",onClick:_e},[M.value?(h(),Z(k,{key:0,class:"text-danger"},{default:u(()=>[l(p(ue))]),_:1})):q.value?(h(),Z(k,{key:1},{default:u(()=>[l(p(Ne))]),_:1})):(h(),Z(k,{key:2},{default:u(()=>[l(p(Le))]),_:1}))]),M.value?(h(),T("div",rt,[e[35]||(e[35]=a("h4",null,"设置",-1)),e[36]||(e[36]=a("hr",{class:"my-2"},null,-1)),l(xe,{class:"mt-4",title:"已定稿","sub-title":"禁止修改"},{icon:u(()=>[l(k,{size:"50",class:"text-danger"},{default:u(()=>[l(p(ue))]),_:1})]),_:1})])):(h(),T("div",Ye,[e[33]||(e[33]=a("h4",null,"设置",-1)),e[34]||(e[34]=a("hr",{class:"my-2"},null,-1)),a("div",Fe,[a("div",je,[e[21]||(e[21]=a("h6",{class:"text-nowrap"},"刮刮乐数量：",-1)),l(se,{class:"w-100",modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=c=>v.value=c),min:B.value},null,8,["modelValue","min"])]),l(G,{type:"danger",class:"mt-2",onClick:e[4]||(e[4]=c=>R())},{default:u(()=>e[22]||(e[22]=[L("重置刮刮乐")])),_:1}),l(G,{type:"danger",class:"ms-0 mt-2",onClick:e[5]||(e[5]=c=>ce())},{default:u(()=>e[23]||(e[23]=[L("强制重置刮刮乐")])),_:1}),a("div",null,[a("div",Ge,[e[24]||(e[24]=a("h6",{class:"text-nowrap"},"启用中奖音效：",-1)),l(he,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=c=>g.value=c)},null,8,["modelValue"]),l(D,{content:"好运来",placement:"top"},{default:u(()=>[l(k,{class:"ms-2",size:"20"},{default:u(()=>[l(p(H))]),_:1})]),_:1})]),a("div",Ke,[e[25]||(e[25]=a("h6",{class:"text-nowrap me-2"},"刮刮乐大小：",-1)),l(we,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=c=>_.value=c),step:10,max:500,min:100},null,8,["modelValue"]),l(D,{content:"强制重置刮刮乐后生效",placement:"top"},{default:u(()=>[l(k,{class:"ms-2",size:"20"},{default:u(()=>[l(p(H))]),_:1})]),_:1})]),a("div",Qe,[e[28]||(e[28]=a("h6",{class:"text-nowrap mb-0"},"中奖模式：",-1)),l(ae,{modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=c=>x.value=c),"aria-label":"size control"},{default:u(()=>[l(j,{value:"serial"},{default:u(()=>e[26]||(e[26]=[L("序号")])),_:1}),l(j,{value:"prize"},{default:u(()=>e[27]||(e[27]=[L("自定义奖品")])),_:1})]),_:1},8,["modelValue"]),l(D,{content:"强制重置刮刮乐后生效",placement:"top"},{default:u(()=>[l(k,{class:"ms-2",size:"20"},{default:u(()=>[l(p(H))]),_:1})]),_:1})]),a("div",Ze,[x.value==="serial"?(h(),T("div",et,[a("div",tt,[e[29]||(e[29]=a("h6",{class:"text-nowrap"},"中奖名次：",-1)),l(se,{class:"w-100",modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=c=>U.value=c),min:1},null,8,["modelValue"]),l(D,{content:"前几名算为中奖",placement:"top"},{default:u(()=>[l(k,{class:"ms-2",size:"20"},{default:u(()=>[l(p(H))]),_:1})]),_:1})])])):(h(),T("div",lt,[a("div",at,[a("div",st,[e[30]||(e[30]=a("h6",{class:"text-nowrap"},"奖品列表：",-1)),l(D,{content:"奖品列表，回车分隔奖品",placement:"top"},{default:u(()=>[l(k,{size:"20"},{default:u(()=>[l(p(H))]),_:1})]),_:1})]),a("div",ot,[l(b,{type:"textarea",modelValue:n.value,"onUpdate:modelValue":e[10]||(e[10]=c=>n.value=c)},null,8,["modelValue"])])]),a("div",nt,[e[31]||(e[31]=a("h6",{class:"text-nowrap"},"未中文本：",-1)),l(b,{modelValue:s.value,"onUpdate:modelValue":e[11]||(e[11]=c=>s.value=c)},null,8,["modelValue"]),l(D,{content:"未中奖的“奖”品",placement:"top"},{default:u(()=>[l(k,{class:"ms-2",size:"20"},{default:u(()=>[l(p(H))]),_:1})]),_:1})])]))]),a("div",ut,[l(Se,{title:"确认定稿？",onConfirm:pe},{reference:u(()=>[l(G,{class:"w-100"},{default:u(()=>e[32]||(e[32]=[L("定稿")])),_:1})]),_:1})])])])]))],2),p(f)?(h(),T("div",it,[a("span",ct,Q(p(o)),1)])):ee("",!0)])}}},pt=ie(dt,[["__scopeId","data-v-05d5d2d2"]]);export{pt as default};
